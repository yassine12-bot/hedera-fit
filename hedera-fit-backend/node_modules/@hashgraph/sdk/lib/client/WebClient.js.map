{"version":3,"file":"WebClient.js","sources":["../../src/client/WebClient.js"],"sourcesContent":["// SPDX-License-Identifier: Apache-2.0\n\nimport Client from \"./Client.js\";\nimport WebChannel from \"../channel/WebChannel.js\";\nimport LedgerId from \"../LedgerId.js\";\nimport { WebNetwork, WebMirrorNetwork } from \"../constants/ClientConstants.js\";\n\nimport AddressBookQuery from \"../network/AddressBookQueryWeb.js\";\nimport FileId from \"../file/FileId.js\";\n\n/**\n * @typedef {import(\"./Client.js\").ClientConfiguration} ClientConfiguration\n * @typedef {import(\"../account/AccountId.js\").default} AccountId\n */\n\n/**\n * Represents a client for interacting with the Hedera network over the web.\n * The `WebClient` class extends the base `Client` class and provides methods\n * for configuring and managing connections to the Hedera network, including\n * setting the network type (mainnet, testnet, previewnet) and handling\n * transactions and queries.\n * @augments {Client<WebChannel, *>}\n */\nexport default class WebClient extends Client {\n    /**\n     * @param {ClientConfiguration} [props]\n     */\n    constructor(props) {\n        super(props);\n\n        if (props != null) {\n            if (typeof props.network === \"string\") {\n                this._setNetworkFromName(props.network);\n            } else if (props.network != null) {\n                Client._validateNetworkConsistency(props.network);\n\n                const { shard, realm } = Client._extractShardRealm(\n                    props.network,\n                );\n\n                // Shard and realm are inferred from the network, so we need to set them here\n                // to ensure that the client is properly configured.\n                this._shard = shard;\n                this._realm = realm;\n\n                this.setNetwork(props.network);\n            }\n\n            if (typeof props.mirrorNetwork === \"string\") {\n                switch (props.mirrorNetwork) {\n                    case \"mainnet\":\n                        this.setMirrorNetwork(WebMirrorNetwork.MAINNET);\n                        break;\n\n                    case \"testnet\":\n                        this.setMirrorNetwork(WebMirrorNetwork.TESTNET);\n                        break;\n\n                    case \"previewnet\":\n                        this.setMirrorNetwork(WebMirrorNetwork.PREVIEWNET);\n                        break;\n\n                    default:\n                        this.setMirrorNetwork([props.mirrorNetwork]);\n                        break;\n                }\n            } else if (props.mirrorNetwork != null) {\n                this.setMirrorNetwork(props.mirrorNetwork);\n            }\n        }\n    }\n\n    /**\n     * @param {string | ClientConfiguration} data\n     * @returns {WebClient}\n     */\n    static fromConfig(data) {\n        return new WebClient(\n            typeof data === \"string\"\n                ? /** @type {ClientConfiguration | undefined} */ (\n                      JSON.parse(data)\n                  )\n                : data,\n        );\n    }\n\n    /**\n     * Construct a client for a specific network.\n     *\n     * It is the responsibility of the caller to ensure that all nodes in the map are part of the\n     * same Hedera network. Failure to do so will result in undefined behavior.\n     *\n     * The client will load balance all requests to Hedera using a simple round-robin scheme to\n     * chose nodes to send transactions to. For one transaction, at most 1/3 of the nodes will be\n     * tried.\n     *\n     * @param {{[key: string]: (string | AccountId)} | string} network\n     * @returns {WebClient}\n     */\n    static forNetwork(network) {\n        return new WebClient({ network });\n    }\n\n    /**\n     * @param {string} network\n     * @returns {WebClient}\n     */\n    static forName(network) {\n        return new WebClient({ network });\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for Mainnet access.\n     *\n     * @returns {WebClient}\n     */\n    static forMainnet() {\n        return new WebClient({\n            network: \"mainnet\",\n        });\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for Testnet access.\n     *\n     * @returns {WebClient}\n     */\n    static forTestnet() {\n        return new WebClient({\n            network: \"testnet\",\n        });\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for Previewnet access.\n     *\n     * @returns {WebClient}\n     */\n    static forPreviewnet() {\n        return new WebClient({\n            network: \"previewnet\",\n        });\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for local-node access.\n     *\n     * @param {object} [props]\n     * @param {boolean} [props.scheduleNetworkUpdate]\n     * @returns {WebClient}\n     */\n    static forLocalNode(props = { scheduleNetworkUpdate: false }) {\n        return new WebClient({\n            network: \"local-node\",\n            ...props,\n        });\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for Mainnet access with network update.\n     *\n     * @returns {Promise<WebClient>}\n     */\n    static async forMainnetAsync() {\n        return new WebClient({\n            network: \"mainnet\",\n        }).updateNetwork();\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for Testnet access with network update.\n     *\n     * @returns {Promise<WebClient>}\n     */\n    static async forTestnetAsync() {\n        return new WebClient({\n            network: \"testnet\",\n        }).updateNetwork();\n    }\n\n    /**\n     * Construct a Hedera client pre-configured for Previewnet access with network update.\n     *\n     * @returns {Promise<WebClient>}\n     */\n    static async forPreviewnetAsync() {\n        return new WebClient({\n            network: \"previewnet\",\n        }).updateNetwork();\n    }\n\n    /**\n     * Construct a client for a specific network with optional network update.\n     * Updates network only if the network is not \"local-node\".\n     *\n     * @param {string} network\n     * @returns {Promise<WebClient>}\n     */\n    static async forNameAsync(network) {\n        const client = new WebClient({ network });\n\n        if (network !== \"local-node\") {\n            await client.updateNetwork();\n        }\n\n        return client;\n    }\n\n    /**\n     * Construct a client configured to use mirror nodes.\n     * This will query the address book to get the network nodes.\n     *\n     * @param {string[] | string} mirrorNetwork\n     * @returns {Promise<WebClient>}\n     */\n    static async forMirrorNetwork(mirrorNetwork) {\n        const client = new WebClient({ mirrorNetwork: mirrorNetwork });\n\n        await client.updateNetwork();\n\n        return client;\n    }\n\n    /**\n     * @param {{[key: string]: (string | AccountId)} | string} network\n     * @returns {void}\n     */\n    setNetwork(network) {\n        if (typeof network === \"string\") {\n            switch (network) {\n                case \"previewnet\":\n                    this._network.setNetwork(WebNetwork.PREVIEWNET);\n                    break;\n                case \"testnet\":\n                    this._network.setNetwork(WebNetwork.TESTNET);\n                    break;\n                case \"mainnet\":\n                    this._network.setNetwork(WebNetwork.MAINNET);\n                    break;\n                case \"local-node\":\n                    this._network.setNetwork(WebNetwork.LOCAL_NODE);\n                    break;\n            }\n        } else {\n            // Check for deprecation warnings for network endpoints with schemes\n            for (const [key] of Object.entries(network)) {\n                if (key.startsWith(\"https://\") || key.startsWith(\"http://\")) {\n                    console.warn(\n                        '[Deprecation Notice] Hiero SDK: Network endpoint \"' +\n                            key +\n                            '\" includes a URL scheme (e.g. \"https://\"). ' +\n                            \"This format was accepted in earlier versions but is now deprecated. \" +\n                            'Please remove the scheme and use \"host:port\" instead (e.g. \"node00.swirldslabs.com:443\"). ' +\n                            \"Support for scheme-prefixed endpoints will be removed in a future major release.\",\n                    );\n                }\n            }\n            this._network.setNetwork(network);\n        }\n    }\n\n    /**\n     * @param {string[] | string} mirrorNetwork\n     * @returns {this}\n     */\n    setMirrorNetwork(mirrorNetwork) {\n        if (typeof mirrorNetwork === \"string\") {\n            switch (mirrorNetwork) {\n                case \"local-node\":\n                    this._mirrorNetwork.setNetwork(WebMirrorNetwork.LOCAL_NODE);\n                    break;\n                case \"previewnet\":\n                    this._mirrorNetwork.setNetwork(WebMirrorNetwork.PREVIEWNET);\n                    break;\n                case \"testnet\":\n                    this._mirrorNetwork.setNetwork(WebMirrorNetwork.TESTNET);\n                    break;\n                case \"mainnet\":\n                    this._mirrorNetwork.setNetwork(WebMirrorNetwork.MAINNET);\n                    break;\n                default:\n                    this._mirrorNetwork.setNetwork([mirrorNetwork]);\n            }\n        } else {\n            this._mirrorNetwork.setNetwork(mirrorNetwork);\n        }\n\n        return this;\n    }\n\n    /**\n     * @private\n     * @param {string} name\n     * @returns {this}\n     */\n    _setNetworkFromName(name) {\n        switch (name) {\n            case \"mainnet\":\n                this.setNetwork(WebNetwork.MAINNET);\n                this.setMirrorNetwork(WebMirrorNetwork.MAINNET);\n                this.setLedgerId(LedgerId.MAINNET);\n                break;\n\n            case \"testnet\":\n                this.setNetwork(WebNetwork.TESTNET);\n                this.setMirrorNetwork(WebMirrorNetwork.TESTNET);\n                this.setLedgerId(LedgerId.TESTNET);\n                break;\n\n            case \"previewnet\":\n                this.setNetwork(WebNetwork.PREVIEWNET);\n                this.setMirrorNetwork(WebMirrorNetwork.PREVIEWNET);\n                this.setLedgerId(LedgerId.PREVIEWNET);\n                break;\n\n            case \"local-node\":\n                this.setNetwork(WebNetwork.LOCAL_NODE);\n                this.setMirrorNetwork(WebMirrorNetwork.LOCAL_NODE);\n                this.setLedgerId(LedgerId.LOCAL_NODE);\n                break;\n\n            default:\n                throw new Error(\n                    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n                    `unknown network: ${name}`,\n                );\n        }\n        return this;\n    }\n\n    /**\n     * @override\n     * @returns {Promise<this>}\n     */\n    async updateNetwork() {\n        if (this._isUpdatingNetwork) {\n            return this;\n        }\n\n        this._isUpdatingNetwork = true;\n\n        try {\n            const addressBook = await new AddressBookQuery()\n                .setFileId(\n                    FileId.getAddressBookFileIdFor(this.shard, this.realm),\n                )\n                .execute(this);\n\n            /** @type {Record<string, AccountId>} */\n            const network = {};\n            for (const nodeAddress of addressBook.nodeAddresses) {\n                for (const endpoint of nodeAddress.addresses) {\n                    if (nodeAddress.accountId != null) {\n                        network[endpoint.toString()] = nodeAddress.accountId;\n                    }\n                }\n            }\n\n            this.setNetwork(network);\n        } catch (/** @type {unknown} */ error) {\n            if (this._logger) {\n                const errorMessage =\n                    error instanceof Error ? error.message : String(error);\n                this._logger.trace(\n                    `failed to update client address book: ${errorMessage}`,\n                );\n            }\n        } finally {\n            this._isUpdatingNetwork = false;\n        }\n\n        return this;\n    }\n\n    /**\n     * @override\n     * @returns {(address: string) => WebChannel}\n     */\n    _createNetworkChannel() {\n        return (address) => new WebChannel(address, this.grpcDeadline);\n    }\n\n    /**\n     * @override\n     * @returns {(address: string) => *}\n     */\n    _createMirrorNetworkChannel() {\n        return () => {\n            throw new Error(\"mirror support is not supported in browsers\");\n        };\n    }\n}\n"],"names":["WebClient","Client","constructor","props","super","network","this","_setNetworkFromName","_validateNetworkConsistency","shard","realm","_extractShardRealm","_shard","_realm","setNetwork","mirrorNetwork","setMirrorNetwork","WebMirrorNetwork","MAINNET","TESTNET","PREVIEWNET","fromConfig","data","JSON","parse","forNetwork","forName","forMainnet","forTestnet","forPreviewnet","forLocalNode","scheduleNetworkUpdate","forMainnetAsync","updateNetwork","forTestnetAsync","forPreviewnetAsync","forNameAsync","client","forMirrorNetwork","_network","WebNetwork","LOCAL_NODE","key","Object","entries","startsWith","console","warn","_mirrorNetwork","name","setLedgerId","LedgerId","Error","_isUpdatingNetwork","addressBook","AddressBookQuery","setFileId","FileId","getAddressBookFileIdFor","execute","nodeAddress","nodeAddresses","endpoint","addresses","accountId","toString","error","_logger","errorMessage","message","String","trace","_createNetworkChannel","address","WebChannel","grpcDeadline","_createMirrorNetworkChannel"],"mappings":"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"}