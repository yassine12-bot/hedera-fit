import e from"./Client.js";import t from"../channel/WebChannel.js";import r from"../LedgerId.js";import{WebMirrorNetwork as s,WebNetwork as o}from"../constants/ClientConstants.js";import n from"../network/AddressBookQueryWeb.js";import i from"../file/FileId.js";class a extends e{constructor(t){if(super(t),null!=t){if("string"==typeof t.network)this._setNetworkFromName(t.network);else if(null!=t.network){e._validateNetworkConsistency(t.network);const{shard:r,realm:s}=e._extractShardRealm(t.network);this._shard=r,this._realm=s,this.setNetwork(t.network)}if("string"==typeof t.mirrorNetwork)switch(t.mirrorNetwork){case"mainnet":this.setMirrorNetwork(s.MAINNET);break;case"testnet":this.setMirrorNetwork(s.TESTNET);break;case"previewnet":this.setMirrorNetwork(s.PREVIEWNET);break;default:this.setMirrorNetwork([t.mirrorNetwork])}else null!=t.mirrorNetwork&&this.setMirrorNetwork(t.mirrorNetwork)}}static fromConfig(e){return new a("string"==typeof e?JSON.parse(e):e)}static forNetwork(e){return new a({network:e})}static forName(e){return new a({network:e})}static forMainnet(){return new a({network:"mainnet"})}static forTestnet(){return new a({network:"testnet"})}static forPreviewnet(){return new a({network:"previewnet"})}static forLocalNode(e={scheduleNetworkUpdate:!1}){return new a({network:"local-node",...e})}static async forMainnetAsync(){return new a({network:"mainnet"}).updateNetwork()}static async forTestnetAsync(){return new a({network:"testnet"}).updateNetwork()}static async forPreviewnetAsync(){return new a({network:"previewnet"}).updateNetwork()}static async forNameAsync(e){const t=new a({network:e});return"local-node"!==e&&await t.updateNetwork(),t}static async forMirrorNetwork(e){const t=new a({mirrorNetwork:e});return await t.updateNetwork(),t}setNetwork(e){if("string"==typeof e)switch(e){case"previewnet":this._network.setNetwork(o.PREVIEWNET);break;case"testnet":this._network.setNetwork(o.TESTNET);break;case"mainnet":this._network.setNetwork(o.MAINNET);break;case"local-node":this._network.setNetwork(o.LOCAL_NODE)}else{for(const[t]of Object.entries(e))(t.startsWith("https://")||t.startsWith("http://"))&&console.warn('[Deprecation Notice] Hiero SDK: Network endpoint "'+t+'" includes a URL scheme (e.g. "https://"). This format was accepted in earlier versions but is now deprecated. Please remove the scheme and use "host:port" instead (e.g. "node00.swirldslabs.com:443"). Support for scheme-prefixed endpoints will be removed in a future major release.');this._network.setNetwork(e)}}setMirrorNetwork(e){if("string"==typeof e)switch(e){case"local-node":this._mirrorNetwork.setNetwork(s.LOCAL_NODE);break;case"previewnet":this._mirrorNetwork.setNetwork(s.PREVIEWNET);break;case"testnet":this._mirrorNetwork.setNetwork(s.TESTNET);break;case"mainnet":this._mirrorNetwork.setNetwork(s.MAINNET);break;default:this._mirrorNetwork.setNetwork([e])}else this._mirrorNetwork.setNetwork(e);return this}_setNetworkFromName(e){switch(e){case"mainnet":this.setNetwork(o.MAINNET),this.setMirrorNetwork(s.MAINNET),this.setLedgerId(r.MAINNET);break;case"testnet":this.setNetwork(o.TESTNET),this.setMirrorNetwork(s.TESTNET),this.setLedgerId(r.TESTNET);break;case"previewnet":this.setNetwork(o.PREVIEWNET),this.setMirrorNetwork(s.PREVIEWNET),this.setLedgerId(r.PREVIEWNET);break;case"local-node":this.setNetwork(o.LOCAL_NODE),this.setMirrorNetwork(s.LOCAL_NODE),this.setLedgerId(r.LOCAL_NODE);break;default:throw new Error(`unknown network: ${e}`)}return this}async updateNetwork(){if(this._isUpdatingNetwork)return this;this._isUpdatingNetwork=!0;try{const e=await(new n).setFileId(i.getAddressBookFileIdFor(this.shard,this.realm)).execute(this),t={};for(const r of e.nodeAddresses)for(const e of r.addresses)null!=r.accountId&&(t[e.toString()]=r.accountId);this.setNetwork(t)}catch(e){if(this._logger){const t=e instanceof Error?e.message:String(e);this._logger.trace(`failed to update client address book: ${t}`)}}finally{this._isUpdatingNetwork=!1}return this}_createNetworkChannel(){return e=>new t(e,this.grpcDeadline)}_createMirrorNetworkChannel(){return()=>{throw new Error("mirror support is not supported in browsers")}}}export{a as default};
//# sourceMappingURL=WebClient.js.map
